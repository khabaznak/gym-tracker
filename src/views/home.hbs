{{> header title="Gym Tracker" subtitle="Powered by Express, HTMX, Tailwind & Supabase"}}

<main class="mx-auto mt-10 flex w-full max-w-5xl flex-col gap-8 px-6 pb-16">
  <section class="rounded-xl bg-white p-6 shadow-lg ring-1 ring-graphite/10 dark:bg-graphite dark:text-fog dark:ring-graphite/40">
    <div class="mb-4 flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
      <h2 class="text-lg font-semibold text-ink dark:text-white">Log a workout</h2>
      {{#unless supabaseReady}}
        <p class="text-sm text-orange dark:text-orange/80">Supabase credentials are missing – form submissions will be disabled.</p>
      {{/unless}}
    </div>
    <form
      hx-post="/workouts"
      hx-target="#workout-list"
      hx-swap="afterbegin"
      hx-indicator="#submit-indicator"
      hx-on::after-request="this.reset()"
      class="grid gap-4 md:grid-cols-2"
    >
      <div class="flex flex-col gap-2">
        <label class="text-sm font-medium text-graphite/80 dark:text-fog/80" for="name">Workout name</label>
        <input
          id="name"
          name="name"
          type="text"
          required
          placeholder="Upper body session"
          class="w-full rounded-lg border border-graphite/20 px-3 py-2 text-sm text-graphite shadow-sm focus:border-teal focus:outline-none focus:ring-2 focus:ring-teal/30 dark:border-fog/15 dark:bg-graphite dark:text-fog dark:placeholder:text-fog/50 dark:focus:border-teal dark:focus:ring-teal/40"
          {{#unless supabaseReady}}disabled{{/unless}}
        />
      </div>
      <div class="flex flex-col gap-2">
        <label class="text-sm font-medium text-graphite/80 dark:text-fog/80" for="performed_at">Performed at</label>
        <input
          id="performed_at"
          name="performed_at"
          type="datetime-local"
          required
          class="w-full rounded-lg border border-graphite/20 px-3 py-2 text-sm text-graphite shadow-sm focus:border-teal focus:outline-none focus:ring-2 focus:ring-teal/30 dark:border-fog/15 dark:bg-graphite dark:text-fog dark:placeholder:text-fog/50 dark:focus:border-teal dark:focus:ring-teal/40"
          {{#unless supabaseReady}}disabled{{/unless}}
        />
      </div>
      <div class="md:col-span-2">
        <label class="mb-2 block text-sm font-medium text-graphite/80 dark:text-fog/80" for="notes">Notes</label>
        <textarea
          id="notes"
          name="notes"
          rows="3"
          placeholder="PR on bench press."
          class="w-full rounded-lg border border-graphite/20 px-3 py-2 text-sm text-graphite shadow-sm focus:border-teal focus:outline-none focus:ring-2 focus:ring-teal/30 dark:border-fog/15 dark:bg-graphite dark:text-fog dark:placeholder:text-fog/50 dark:focus:border-teal dark:focus:ring-teal/40"
          {{#unless supabaseReady}}disabled{{/unless}}
        ></textarea>
      </div>
      <div class="flex items-center gap-3 md:col-span-2">
        <button
          type="submit"
          class="inline-flex items-center gap-2 rounded-lg bg-teal px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-teal-dark focus:outline-none focus:ring-2 focus:ring-teal/40 dark:bg-orange dark:hover:bg-orange-dark dark:focus:ring-orange/40"
          {{#unless supabaseReady}}disabled{{/unless}}
        >
          Save workout
        </button>
        <span id="submit-indicator" class="htmx-indicator text-sm text-graphite/70 dark:text-fog/70">Saving…</span>
      </div>
    </form>
  </section>

  <section class="flex flex-col gap-4">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-semibold text-ink dark:text-white">Recent workouts</h2>
      <button
        type="button"
        class="text-sm font-semibold text-teal hover:text-teal-dark dark:text-orange dark:hover:text-orange-dark"
        hx-get="/workouts/fragment"
        hx-target="#workout-list"
        hx-swap="innerHTML"
      >
        Refresh
      </button>
    </div>
    <div
      id="workout-list"
      class="grid gap-3"
      hx-get="/workouts/fragment"
      hx-trigger="load"
      hx-swap="innerHTML"
    >
      {{> workouts/list workouts=workouts supabaseReady=supabaseReady}}
    </div>
  </section>
</main>
