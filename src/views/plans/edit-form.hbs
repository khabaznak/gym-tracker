{{#with plan}}
  <article
    id="plan-{{id}}"
    class="rounded-lg border border-graphite/10 bg-white p-4 text-sm text-graphite/80 shadow-sm dark:border-fog/15 dark:bg-graphite dark:text-fog/80"
  >
    <form
      class="space-y-4"
      hx-put="/plans/{{id}}"
      hx-target="#plan-{{id}}"
      hx-swap="outerHTML"
      hx-on="htmx:afterSwap: if (event.detail.xhr.status === 200) { document.dispatchEvent(new CustomEvent('plan-form:saved')); }"
      data-plan-form
      data-workouts='{{{json ../workouts}}}'
      data-initial-assignments='{{{json assignments}}}'
    >
      <div class="flex flex-wrap items-start justify-between gap-3">
        <div class="space-y-1">
          <h3 class="text-base font-semibold text-ink dark:text-white">Edit {{name}}</h3>
          <p class="text-xs uppercase tracking-wide text-graphite/60 dark:text-fog/60">{{capitalize period}}</p>
        </div>
        <span class="htmx-indicator text-xs uppercase tracking-wide text-graphite/60 dark:text-fog/60">Savingâ€¦</span>
      </div>

      <fieldset class="grid gap-4 md:grid-cols-2">
        <div class="flex flex-col gap-2">
          <label class="text-sm font-medium text-graphite/80 dark:text-fog/80" for="edit-plan-name-{{id}}">Plan name<span class="text-orange">*</span></label>
          <input
            id="edit-plan-name-{{id}}"
            name="name"
            type="text"
            value="{{name}}"
            required
            class="w-full rounded-lg border border-graphite/20 px-3 py-2 text-sm text-graphite shadow-sm focus:border-teal focus:outline-none focus:ring-2 focus:ring-teal/30 dark:border-fog/15 dark:bg-graphite dark:text-fog dark:focus:border-teal dark:focus:ring-teal/40"
          />
        </div>
        <div class="flex flex-col gap-2">
          <label class="text-sm font-medium text-graphite/80 dark:text-fog/80" for="edit-plan-period-{{id}}">Period<span class="text-orange">*</span></label>
          <select
            id="edit-plan-period-{{id}}"
            name="period"
            class="w-full rounded-lg border border-graphite/20 px-3 py-2 text-sm text-graphite shadow-sm focus:border-teal focus:outline-none focus:ring-2 focus:ring-teal/30 dark:border-fog/15 dark:bg-graphite dark:text-fog dark:focus:border-teal dark:focus:ring-teal/40"
          >
            <option value="weekly" {{#if (eq period 'weekly')}}selected{{/if}}>Weekly</option>
            <option value="bi-weekly" {{#if (eq period 'bi-weekly')}}selected{{/if}}>Bi-weekly</option>
            <option value="monthly" {{#if (eq period 'monthly')}}selected{{/if}}>Monthly</option>
          </select>
        </div>
        <div class="flex flex-col gap-2">
          <label class="text-sm font-medium text-graphite/80 dark:text-fog/80" for="edit-plan-status-{{id}}">Status</label>
          <select
            id="edit-plan-status-{{id}}"
            name="status"
            class="w-full rounded-lg border border-graphite/20 px-3 py-2 text-sm text-graphite shadow-sm focus:border-teal focus:outline-none focus:ring-2 focus:ring-teal/30 dark:border-fog/15 dark:bg-graphite dark:text-fog dark:focus:border-teal dark:focus:ring-teal/40"
          >
            <option value="active" {{#if (eq status 'active')}}selected{{/if}}>Active</option>
            <option value="inactive" {{#if (eq status 'inactive')}}selected{{/if}}>Inactive</option>
          </select>
        </div>
        <div class="md:col-span-2 flex flex-col gap-2">
          <label class="text-sm font-medium text-graphite/80 dark:text-fog/80" for="edit-plan-description-{{id}}">Description</label>
          <textarea
            id="edit-plan-description-{{id}}"
            name="description"
            rows="3"
            class="w-full rounded-lg border border-graphite/20 px-3 py-2 text-sm text-graphite shadow-sm focus:border-teal focus:outline-none focus:ring-2 focus:ring-teal/30 dark:border-fog/15 dark:bg-graphite dark:text-fog dark:focus:border-teal dark:focus:ring-teal/40"
          >{{description}}</textarea>
        </div>
      </fieldset>

      <div class="space-y-4" data-plan-schedule>
        <div class="flex items-center justify-between">
          <h3 class="text-sm font-semibold uppercase tracking-wide text-graphite/60 dark:text-fog/60">Schedule</h3>
          <button
            type="button"
            data-action="add-assignment"
            class="inline-flex items-center gap-2 rounded-lg border border-graphite/20 px-3 py-1.5 text-xs font-semibold uppercase tracking-wide text-graphite transition hover:border-graphite/40 hover:text-ink focus:outline-none focus:ring-2 focus:ring-graphite/30 dark:border-fog/30 dark:text-fog dark:hover:border-fog/60 dark:hover:text-white dark:focus:ring-fog/30"
          >
            Add assignment
          </button>
        </div>
        <div class="flex flex-col gap-3" data-plan-assignments></div>
      </div>

      <div class="flex flex-wrap items-center gap-3">
        <button
          type="submit"
          class="inline-flex items-center gap-2 rounded-lg bg-teal px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-teal-dark focus:outline-none focus:ring-2 focus:ring-teal/40 dark:bg-orange dark:hover:bg-orange-dark dark:focus:ring-orange/40"
        >
          Save changes
        </button>
        <button
          type="button"
          class="inline-flex items-center gap-2 rounded-lg border border-graphite/20 px-4 py-2 text-sm font-semibold text-graphite transition hover:border-graphite/40 hover:text-ink focus:outline-none focus:ring-2 focus:ring-graphite/30 dark:border-fog/30 dark:text-fog dark:hover:border-fog/60 dark:hover:text-white dark:focus:ring-fog/30"
          hx-get="/plans/{{id}}/fragment?mode=manage"
          hx-target="#plan-{{id}}"
          hx-swap="outerHTML"
        >
          Cancel
        </button>
        <button
          type="button"
          class="inline-flex items-center gap-2 rounded-lg border border-red-300 px-4 py-2 text-sm font-semibold text-red-600 transition hover:border-red-400 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-200 dark:border-orange/50 dark:text-orange dark:hover:border-orange dark:hover:text-orange/80 dark:focus:ring-orange/30"
          data-action="delete-plan"
          data-plan-id="{{id}}"
          data-plan-name="{{name}}"
        >
          Delete
        </button>
      </div>
    </form>
  </article>
{{/with}}
